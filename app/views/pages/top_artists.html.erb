<% content_for :extra_css do %>
  <%= stylesheet_link_tag "dashboard", media: "all" %>
  
<% end %>

<main class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3 px-3 me-3">
    <h1>
      Your Top Artists</span>
    </h1>

    <%= form_with url: top_artists_path, method: :get, local: true,
                  class: "d-flex align-items-center gap-2 mb-0" do %>
      <label for="limit" class="me-2 text-secondary fw-semibold">Show</label>

      <%= select_tag :limit,
            options_for_select(
              [["Top 10", 10], ["Top 25", 25], ["Top 50", 50]],
              selected: (params[:limit].presence || 10)
            ),
            class: "form-select form-select-sm bg-dark text-white border-secondary",
            onchange: "this.form.submit();" %>

      <!--submit button: hidden when JS is enabled -->
      <%= submit_tag "Update", class: "btn btn-sm btn-outline-light ms-2 js-hidden" %>
    <% end %>
  </div>

  <div class="spotify-card p-3 me-3 mb-4">
    <% if flash[:alert].present? %>
      <div class="alert alert-warning">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <% if @top_artists.present? %>
      <div class="top-artists-list">
        <% @top_artists.each_with_index do |artist, idx| %>
          <div class="top-artist d-flex align-items-center mb-3">
            <div class="text-center me-3">
              <span class="badge bg-secondary fs-6">#<%= idx + 1 %></span>
            </div>

            <% image_url = artist.respond_to?(:image_url) ? artist.image_url : artist['image_url'] %>
            <% if image_url.present? %>
              <div class="me-3">
                <%= image_tag image_url, alt: (artist.respond_to?(:name) ? artist.name : artist['name']), class: 'rounded-circle border', size: "64x64" %>
              </div>
            <% end %>

            <div class="me-3">
              <strong class="artist-name"><%= artist.respond_to?(:name) ? artist.name : artist['name'] %></strong>
              <div class="text-muted artist-plays">Plays: <%= artist.respond_to?(:playcount) ? artist.playcount : artist['playcount'] %></div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-secondary">We don't have your top artists yet. Connect your Spotify account or try again later.</p>
    <% end %>

    <div class="mt-3">
      <%= link_to 'Back to dashboard', dashboard_path, class: 'btn btn-secondary' %>
    </div>
  </div>
</main>
