<% content_for :extra_css do %>
  <%= stylesheet_link_tag "dashboard", media: "all" %>
<% end %>

<main class="container mt-4">
  <h1>Your Dashboard</h1>
  <div class="spotify-card p-3 me-3 mb-4">
    <h5 class="text-light mb-1">Top Tracks</h5>

    <% if @primary_track.present? %>
      <div class="d-flex align-items-center mb-3">
        <% if @primary_track.album_image_url.present? %>
          <%= image_tag @primary_track.album_image_url, 
                        alt: @primary_track.album_name, 
                        class: 'rounded border me-3', 
                        size: "72x72" %>
        <% end %>
        <div>
          <strong class="text-light fs-5"><%= @primary_track.name %></strong>
          <div class="text-secondary small"><%= @primary_track.artists %></div>
          <div class="text-secondary small">Album: <%= @primary_track.album_name %></div>
          <div class="text-secondary small">Popularity: <%= @primary_track.popularity %>/100</div>
        </div>
      </div>

      <% if @top_tracks.second.present? %>
        <ul class="list-unstyled text-secondary small mb-0">
          <% @top_tracks.first(5).each_with_index do |track, idx| %>
            <li class="d-flex align-items-start">
              <span class="badge bg-secondary me-2">#<%= idx + 1 %></span>
              <div>
                <span class="text-light"><%= track.name %></span>
                <div class="text-secondary small"><%= track.artists %></div>
              </div>
            </li>
          <% end %>
        </ul>
      <% end %>
    <% end %>

    <div class="mt-3">
      <%= link_to 'View top 10 tracks this year', top_tracks_path , class: 'btn btn-spotify' %>
    </div>
  </div>
  <div class="spotify-card p-3 me-3 mb-4">
    <h5 class="text-light mb-1">Top Artists</h5>

    <% if @primary_artist.present? %>
      <div class="d-flex align-items-center mb-3">
        <% if @primary_artist.image_url.present? %>
          <%= image_tag @primary_artist.image_url, alt: @primary_artist.name, class: 'rounded-circle border me-3', size: "72x72" %>
        <% end %>
        <div>
          <strong class="text-light fs-5"><%= @primary_artist.name %></strong>
          <div class="text-secondary small">Plays: <%= @primary_artist.playcount %></div>
        </div>
      </div>

      <% if @top_artists.second.present? %>
        <ul class="list-unstyled text-secondary small mb-0">
          <% @top_artists.first(5).each_with_index do |artist, idx| %>
            <li>
              <span class="badge bg-secondary me-2">#<%= idx + 1 %></span>
              <%= artist.name %>
            </li>
          <% end %>
        </ul>
      <% end %>
    <% else %>
      <p class="text-secondary mb-3">We couldn't load your top artists right now. Please try again soon.</p>
    <% end %>

    <div class="mt-3">
      <%= link_to 'View Top Artists', top_artists_path, class: 'btn btn-spotify' %>
    </div>
  </div>
</main>
